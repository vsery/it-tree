/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(k,q){var h=this.length;if("function"!=typeof k)throw new TypeError;for(var m=0;m<h;m++)if(m in this&&k.call(q,this[m],m,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(k,q){var h=this.length;if("function"!=typeof k)throw new TypeError;for(var m=0;m<h;m++)m in this&&k.call(q,this[m],m,this)});Array.prototype.map||(Array.prototype.map=function(k,q){var h=this.length;if("function"!=typeof k)throw new TypeError;
for(var m=Array(h),n=0;n<h;n++)n in this&&(m[n]=k.call(q,this[n],n,this));return m});Array.prototype.filter||(Array.prototype.filter=function(k,q){var h=this.length;if("function"!=typeof k)throw new TypeError;for(var m=[],n=0;n<h;n++)if(n in this){var u=this[n];k.call(q,u,n,this)&&m.push(u)}return m});Object.keys||(Object.keys=function(){var k=Object.prototype.hasOwnProperty,q=!{toString:null}.propertyIsEnumerable("toString"),h="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
m=h.length;return function(n){if("object"!==typeof n&&"function"!==typeof n||null===n)throw new TypeError("Object.keys called on non-object");var u=[],t;for(t in n)k.call(n,t)&&u.push(t);if(q)for(t=0;t<m;t++)k.call(n,h[t])&&u.push(h[t]);return u}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(k,q){if("string"==typeof k&&void 0==q)return this.p[k];var h="object"==typeof k&&void 0==q?k:{};"string"==typeof k&&(h[k]=q);for(var m in h)void 0!=this.p[m]&&(this.p[m]=h[m]);return this}};
sigma.classes.EventDispatcher=function(){var k={},q=this;this.one=function(h,m){if(!m||!h)return q;("string"==typeof h?h.split(" "):h).forEach(function(h){k[h]||(k[h]=[]);k[h].push({h:m,one:!0})});return q};this.bind=function(h,m){if(!m||!h)return q;("string"==typeof h?h.split(" "):h).forEach(function(h){k[h]||(k[h]=[]);k[h].push({h:m,one:!1})});return q};this.unbind=function(h,m){h||(k={});var n="string"==typeof h?h.split(" "):h;m?n.forEach(function(h){k[h]&&(k[h]=k[h].filter(function(h){return h.h!=
m}));k[h]&&0==k[h].length&&delete k[h]}):n.forEach(function(h){delete k[h]});return q};this.dispatch=function(h,m){k[h]&&(k[h].forEach(function(k){k.h({type:h,content:m,target:q})}),k[h]=k[h].filter(function(h){return!h.one}));return q}};
(function(){function k(b,l){function f(){sigma.chronos.removeTask("node_"+c.id,2).removeTask("edge_"+c.id,2).removeTask("label_"+c.id,2).stopTasks();return c}function d(a,d){c.domElements[a]=document.createElement(d);c.domElements[a].style.position="absolute";c.domElements[a].setAttribute("id","sigma_"+a+"_"+c.id);c.domElements[a].setAttribute("class","sigma_"+a+"_"+d);c.domElements[a].setAttribute("width",c.width+"px");c.domElements[a].setAttribute("height",c.height+"px");c.domRoot.appendChild(c.domElements[a]);
return c}function a(){c.p.drawHoverNodes&&(c.graph.checkHover(c.mousecaptor.mouseX,c.mousecaptor.mouseY),c.graph.nodes.forEach(function(a){a.hover&&!a.active&&c.plotter.drawHoverNode(a)}));return c}function p(){c.p.drawActiveNodes&&c.graph.nodes.forEach(function(a){a.active&&c.plotter.drawActiveNode(a)});return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.id=l.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,
drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=b;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new n;this.domElements={};d("edges","canvas");d("nodes","canvas");d("labels","canvas");d("hover","canvas");d("monitor","div");d("mouse","canvas");this.plotter=new q(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=
new h(this,this.domElements.monitor);this.mousecaptor=new u(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(a){c.draw(c.p.auto?2:c.p.drawNodes,c.p.auto?0:c.p.drawEdges,c.p.auto?2:c.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(a){c.draw(c.p.auto?2:c.p.drawNodes,c.p.auto?1:c.p.drawEdges,c.p.auto?2:c.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var d=c.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});c.dispatch("mousedown"==
a.type?"downgraph":"upgraph");d.length&&c.dispatch("mousedown"==a.type?"downnodes":"upnodes",d)}).bind("move",function(){c.domElements.hover.getContext("2d").clearRect(0,0,c.domElements.hover.width,c.domElements.hover.height);a();p()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+c.id+"$",""))})&&c.draw(c.p.auto?2:c.p.drawNodes,c.p.auto?0:c.p.drawEdges,c.p.auto?2:c.p.drawLabels)}).bind("stopgenerators",function(){c.draw()});
for(var s=0;s<G.plugins.length;s++)G.plugins[s](this);this.draw=function(a,d,b,g){if(g&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+c.id+"$",""))}))return c;a=void 0==a?c.p.drawNodes:a;d=void 0==d?c.p.drawEdges:d;b=void 0==b?c.p.drawLabels:b;g={nodes:a,edges:d,labels:b};c.p.lastNodes=a;c.p.lastEdges=d;c.p.lastLabels=b;f();c.graph.rescale(c.width,c.height,0<a,0<d).setBorders();c.mousecaptor.checkBorders(c.graph.borders,c.width,c.height);c.graph.translate(c.mousecaptor.stageX,
c.mousecaptor.stageY,c.mousecaptor.ratio,0<a,0<d);c.dispatch("graphscaled");for(var p in c.domElements)"canvas"==c.domElements[p].nodeName.toLowerCase()&&(void 0==g[p]||0<=g[p])&&c.domElements[p].getContext("2d").clearRect(0,0,c.domElements[p].width,c.domElements[p].height);c.plotter.currentEdgeIndex=0;c.plotter.currentNodeIndex=0;c.plotter.currentLabelIndex=0;p=null;g=!1;if(a)if(1<a)for(;c.plotter.task_drawNode(););else sigma.chronos.addTask(c.plotter.task_drawNode,"node_"+c.id,!1),g=!0,p="node_"+
c.id;if(b)if(1<b)for(;c.plotter.task_drawLabel(););else p?sigma.chronos.queueTask(c.plotter.task_drawLabel,"label_"+c.id,p):sigma.chronos.addTask(c.plotter.task_drawLabel,"label_"+c.id,!1),g=!0,p="label_"+c.id;if(d)if(1<d)for(;c.plotter.task_drawEdge(););else p?sigma.chronos.queueTask(c.plotter.task_drawEdge,"edge_"+c.id,p):sigma.chronos.addTask(c.plotter.task_drawEdge,"edge_"+c.id,!1),g=!0,p="edge_"+c.id;c.dispatch("draw");c.refresh();g&&sigma.chronos.runTasks();return c};this.resize=function(a,
d){var b=c.width,g=c.height;void 0!=a&&void 0!=d?(c.width=a,c.height=d):(c.width=c.domRoot.offsetWidth,c.height=c.domRoot.offsetHeight);if(b!=c.width||g!=c.height){for(var p in c.domElements)c.domElements[p].setAttribute("width",c.width+"px"),c.domElements[p].setAttribute("height",c.height+"px");c.plotter.resize(c.width,c.height);c.draw(c.p.lastNodes,c.p.lastEdges,c.p.lastLabels,!0)}return c};this.refresh=function(){c.domElements.hover.getContext("2d").clearRect(0,0,c.domElements.hover.width,c.domElements.hover.height);
a();p();return c};this.drawHover=a;this.drawActive=p;this.clearSchedule=f;window.addEventListener("resize",function(){c.resize()})}function q(b,l,f,d,a,p,c){function s(a){var c=d,b="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*a.displaySize;c.font=(g.p.hoverFontStyle||g.p.fontStyle||"")+" "+b+"px "+(g.p.hoverFont||g.p.font||"");c.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:g.p.defaultHoverLabelBGColor;c.beginPath();g.p.labelHoverShadow&&(c.shadowOffsetX=
0,c.shadowOffsetY=0,c.shadowBlur=4,c.shadowColor=g.p.labelHoverShadowColor);sigma.tools.drawRoundRect(c,Math.round(a.displayX-b/2-2),Math.round(a.displayY-b/2-2),Math.round(c.measureText(a.label).width+1.5*a.displaySize+b/2+4),Math.round(b+4),Math.round(b/2+2),"left");c.closePath();c.fill();c.shadowOffsetX=0;c.shadowOffsetY=0;c.shadowBlur=0;c.beginPath();c.fillStyle="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeBorderColor;c.arc(Math.round(a.displayX),Math.round(a.displayY),
a.displaySize+g.p.borderSize,0,2*Math.PI,!0);c.closePath();c.fill();c.beginPath();c.fillStyle="node"==g.p.nodeHoverColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeHoverColor;c.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);c.closePath();c.fill();c.fillStyle="node"==g.p.labelHoverColor?a.color||g.p.defaultNodeColor:g.p.defaultLabelHoverColor;c.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+b/2-3));return g}function h(a){if(isNaN(a.x)||
isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-k/3&&a.displayX-a.displaySize<4*k/3&&a.displayY+a.displaySize>-m/3&&a.displayY-a.displaySize<4*m/3}function z(a,c){return c==a||"both"==c||!c&&(g.p.defaultEdgeArrow==a||"both"==g.p.defaultEdgeArrow)}function x(a,c,d,b,g,p){var f=c[0]-b,s=c[1]-g;d/=Math.sqrt(f*f+s*s);c[0]-=f*d;c[1]-=s*d;a.lineWidth=0;a.fillStyle=a.strokeStyle;sigma.tools.drawArrowhead(a,c[0],c[1],p,sigma.tools.getIncidenceAngle(b,
g,c[0],c[1]));return c}sigma.classes.Cascade.call(this);var g=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,
labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultEdgeArrow:"none",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var k=p,m=c;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=
0;this.task_drawLabel=function(){for(var c=a.nodes.length,d=0;d++<g.p.labelsSpeed&&g.currentLabelIndex<c;)if(g.isOnScreen(a.nodes[g.currentLabelIndex])){var b=a.nodes[g.currentLabelIndex++],p=f;if(b.displaySize>=g.p.labelThreshold||b.forceLabel){var s="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*b.displaySize;p.font=g.p.fontStyle+s+"px "+g.p.font;p.fillStyle="node"==g.p.labelColor?b.color||g.p.defaultNodeColor:g.p.defaultLabelColor;p.fillText(b.label,Math.round(b.displayX+1.5*b.displaySize),
Math.round(b.displayY+s/2-3))}}else g.currentLabelIndex++;return g.currentLabelIndex<c};this.task_drawEdge=function(){for(var c=a.edges.length,d,b,p=0;p++<g.p.edgesSpeed&&g.currentEdgeIndex<c;)if(e=a.edges[g.currentEdgeIndex],d=e.source,b=e.target,e.hidden||d.hidden||b.hidden||!g.isOnScreen(d)&&!g.isOnScreen(b))g.currentEdgeIndex++;else{d=a.edges[g.currentEdgeIndex++];b=[d.source.displayX,d.source.displayY];var f=[d.target.displayX,d.target.displayY],s=d.color;if(!s)switch(g.p.edgeColor){case "source":s=
d.source.color||g.p.defaultNodeColor;break;case "target":s=d.target.color||g.p.defaultNodeColor;break;default:s=g.p.defaultEdgeColor}var r=l;switch(d.type||g.p.defaultEdgeType){case "curve":r.strokeStyle=s;var s=(b[0]+f[0])/2+(f[1]-b[1])/4,h=(b[1]+f[1])/2+(b[0]-f[0])/4;z("source",d.arrow)&&(b=x(r,b,d.source.displaySize,s,h,d.arrowDisplaySize));z("target",d.arrow)&&(f=x(r,f,d.target.displaySize,s,h,d.arrowDisplaySize));r.lineWidth=d.displaySize/3;r.beginPath();r.moveTo(b[0],b[1]);r.quadraticCurveTo(s,
h,f[0],f[1]);r.stroke();break;default:r.strokeStyle=s,z("source",d.arrow)&&(b=x(r,b,d.source.displaySize,f[0],f[1],d.arrowDisplaySize)),z("target",d.arrow)&&(f=x(r,f,d.target.displaySize,b[0],b[1],d.arrowDisplaySize)),r.lineWidth=d.displaySize/3,r.beginPath(),r.moveTo(b[0],b[1]),r.lineTo(f[0],f[1]),r.stroke()}}return g.currentEdgeIndex<c};this.task_drawNode=function(){for(var c=a.nodes.length,d=0;d++<g.p.nodesSpeed&&g.currentNodeIndex<c;)if(g.isOnScreen(a.nodes[g.currentNodeIndex])){var p=a.nodes[g.currentNodeIndex++],
f=Math.round(10*p.displaySize)/10,l=b;l.fillStyle=p.color;l.beginPath();l.arc(p.displayX,p.displayY,f,0,2*Math.PI,!0);l.closePath();l.fill();p.hover&&s(p)}else g.currentNodeIndex++;return g.currentNodeIndex<c};this.drawActiveNode=function(a){var c=d;if(!h(a))return g;var b="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*a.displaySize;c.font=(g.p.activeFontStyle||g.p.fontStyle||"")+" "+b+"px "+(g.p.activeFont||g.p.font||"");c.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:
g.p.defaultActiveLabelBGColor;c.beginPath();g.p.labelActiveShadow&&(c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=4,c.shadowColor=g.p.labelActiveShadowColor);sigma.tools.drawRoundRect(c,Math.round(a.displayX-b/2-2),Math.round(a.displayY-b/2-2),Math.round(c.measureText(a.label).width+1.5*a.displaySize+b/2+4),Math.round(b+4),Math.round(b/2+2),"left");c.closePath();c.fill();c.shadowOffsetX=0;c.shadowOffsetY=0;c.shadowBlur=0;c.beginPath();c.fillStyle="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:
g.p.defaultNodeBorderColor;c.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+g.p.borderSize,0,2*Math.PI,!0);c.closePath();c.fill();c.beginPath();c.fillStyle="node"==g.p.nodeActiveColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeActiveColor;c.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);c.closePath();c.fill();c.fillStyle="node"==g.p.labelActiveColor?a.color||g.p.defaultNodeColor:g.p.defaultLabelActiveColor;c.fillText(a.label,Math.round(a.displayX+
1.5*a.displaySize),Math.round(a.displayY+b/2-3));return g};this.drawHoverNode=s;this.isOnScreen=h;this.resize=function(a,c){k=a;m=c;return g}}function h(b,l){function f(){var a;a="<p>GLOBAL :</p>";for(var b in d.p.globalProbes)a+="<p>"+b+" : "+d.p.globalProbes[b]()+"</p>";a+="<br><p>LOCAL :</p>";for(b in d.p.localProbes)a+="<p>"+b+" : "+d.p.localProbes[b]()+"</p>";d.p.dom.innerHTML=a;return d}sigma.classes.Cascade.call(this);var d=this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:l,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,
Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return d.instance.graph.nodes.length},"Edges count":function(){return d.instance.graph.edges.length}}};this.activate=function(){d.monitoring||(d.monitoring=window.setInterval(f,1E3/d.p.fps));return d};this.desactivate=function(){d.monitoring&&(window.clearInterval(d.monitoring),d.monitoring=null,d.p.dom.innerHTML="");return d}}function m(b){var l=this;sigma.classes.EventDispatcher.call(this);
this._core=b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(f,d){var a=b.config(f,d);return a==b?l:a};this.drawingProperties=function(f,d){var a=b.plotter.config(f,d);return a==b.plotter?l:a};this.mouseProperties=function(f,d){var a=b.mousecaptor.config(f,d);return a==b.mousecaptor?l:a};this.graphProperties=function(f,d){var a=b.graph.config(f,d);return a==b.graph?l:a};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,
down:b.mousecaptor.isMouseDown}};this.position=function(f,d,a){if(0==arguments.length)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};b.mousecaptor.stageX=void 0!=f?f:b.mousecaptor.stageX;b.mousecaptor.stageY=void 0!=d?d:b.mousecaptor.stageY;b.mousecaptor.ratio=void 0!=a?a:b.mousecaptor.ratio;return l};this.goTo=function(f,d,a){b.mousecaptor.interpolate(f,d,a);return l};this.zoomTo=function(f,d,a){a=Math.min(Math.max(b.mousecaptor.config("minRatio"),a),b.mousecaptor.config("maxRatio"));
a==b.mousecaptor.ratio?b.mousecaptor.interpolate(f-b.width/2+b.mousecaptor.stageX,d-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((a*f-b.mousecaptor.ratio*b.width/2)/(a-b.mousecaptor.ratio),(a*d-b.mousecaptor.ratio*b.height/2)/(a-b.mousecaptor.ratio),a);return l};this.resize=function(f,d){b.resize(f,d);return l};this.draw=function(f,d,a,p){b.draw(f,d,a,p);return l};this.refresh=function(){b.refresh();return l};this.addGenerator=function(f,d,a){sigma.chronos.addGenerator(f+"_ext_"+b.id,
d,a);return l};this.removeGenerator=function(f){sigma.chronos.removeGenerator(f+"_ext_"+b.id);return l};this.addNode=function(f,d){b.graph.addNode(f,d);return l};this.addEdge=function(f,d,a,p){b.graph.addEdge(f,d,a,p);return l};this.dropNode=function(f){b.graph.dropNode(f);return l};this.dropEdge=function(f){b.graph.dropEdge(f);return l};this.pushGraph=function(f,d){f.nodes&&f.nodes.forEach(function(a){!a.id||d&&b.graph.nodesIndex[a.id]||l.addNode(a.id,a)});f.edges&&f.edges.forEach(function(a){validID=
a.source&&a.target&&a.id;!validID||d&&b.graph.edgesIndex[a.id]||l.addEdge(a.id,a.source,a.target,a)});return l};this.emptyGraph=function(){b.graph.empty();return l};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(f,d){b.graph.iterNodes(f,d);return l};this.iterEdges=function(f,d){b.graph.iterEdges(f,d);return l};this.getNodes=function(f){return b.graph.getNodes(f)};this.getEdges=function(f){return b.graph.getEdges(f)};
this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downgraph upgraph",function(b){l.dispatch(b.type,b.content)});b.graph.bind("overnodes outnodes",function(b){l.dispatch(b.type,b.content)})}function n(){function b(a){return{x:a.x,y:a.y,size:a.size,degree:a.degree,inDegree:a.inDegree,outDegree:a.outDegree,displayX:a.displayX,displayY:a.displayY,displaySize:a.displaySize,label:a.label,id:a.id,
color:a.color,fixed:a.fixed,active:a.active,hidden:a.hidden,forceLabel:a.forceLabel,attr:a.attr}}function l(a){return{source:a.source.id,target:a.target.id,size:a.size,type:a.type,arrow:a.arrow,weight:a.weight,displaySize:a.displaySize,label:a.label,hidden:a.hidden,id:a.id,attr:a.attr,color:a.color}}function f(){d.nodes=[];d.nodesIndex={};d.edges=[];d.edgesIndex={};return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,
maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0,sideMargin:0,arrowRatio:3};this.borders={};f();this.addNode=function(a,b){if(d.nodesIndex[a]&&"function"!==typeof d.nodesIndex[a])throw Error('Node "'+a+'" already exists.');b=b||{};var c={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,label:a.toString(),id:a.toString(),attr:{}},f;for(f in b)switch(f){case "id":break;case "x":case "y":case "size":c[f]=+b[f];break;case "fixed":case "active":case "hidden":case "forceLabel":c[f]=
!!b[f];break;case "color":case "label":c[f]=b[f];break;default:c.attr[f]=b[f]}d.nodes.push(c);d.nodesIndex[a.toString()]=c;return d};this.addEdge=function(a,b,c,f){if(d.edgesIndex[a])throw Error('Edge "'+a+'" already exists.');if(!d.nodesIndex[b])throw Error("Edge's source \""+b+'" does not exist yet.');if(!d.nodesIndex[c])throw Error("Edge's target \""+c+'" does not exist yet.');f=f||{};b={source:d.nodesIndex[b],target:d.nodesIndex[c],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),
hidden:!1,attr:{}};b.source.degree++;b.source.outDegree++;b.target.degree++;b.target.inDegree++;for(var l in f)switch(l){case "id":case "source":case "target":break;case "hidden":b[l]=!!f[l];break;case "size":case "weight":b[l]=+f[l];break;case "color":case "arrow":case "type":b[l]=f[l].toString();break;case "label":b[l]=f[l];break;default:b.attr[l]=f[l]}d.edges.push(b);d.edgesIndex[a.toString()]=b;return d};this.dropNode=function(a){var b={};((a instanceof Array?a:[a])||[]).forEach(function(a){d.nodesIndex[a]?
b[a]=!0:sigma.log('Node "'+a+'" does not exist.')});var c=[];d.nodes.forEach(function(a,d){a.id in b&&(c.unshift(d),0==a.degree&&delete b[a.id])});c.forEach(function(a){d.nodes.splice(a,1)});d.edges=d.edges.filter(function(a){return a.source.id in b?(delete d.edgesIndex[a.id],a.target.degree--,a.target.inDegree--,!1):a.target.id in b?(delete d.edgesIndex[a.id],a.source.degree--,a.source.outDegree--,!1):!0});return d};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(d.edgesIndex[a]){d.edgesIndex[a].source.degree--;
d.edgesIndex[a].source.outDegree--;d.edgesIndex[a].target.degree--;d.edgesIndex[a].target.inDegree--;var c=null;d.edges.some(function(b,d){return b.id==a?(c=d,!0):!1});null!=c&&d.edges.splice(c,1);delete d.edgesIndex[a]}else sigma.log('Edge "'+a+'" does not exist.')});return d};this.iterEdges=function(a,b){var c=b?b.map(function(a){return d.edgesIndex[a]}):d.edges,f=c.map(l);f.forEach(a);c.forEach(function(a,c){var b=f[c],g;for(g in b)switch(g){case "id":case "displaySize":break;case "weight":case "size":a[g]=
+b[g];break;case "source":case "target":a[g]=d.nodesIndex[g]||a[g];break;case "hidden":a[g]=!!b[g];break;case "color":case "label":case "arrow":case "type":a[g]=(b[g]||"").toString();break;default:a.attr[g]=b[g]}});return d};this.iterNodes=function(a,f){var c=f?f.map(function(a){return d.nodesIndex[a]}):d.nodes,l=c.map(b);l.forEach(a);c.forEach(function(a,c){var b=l[c],d;for(d in b)switch(d){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;
case "x":case "y":case "size":a[d]=+b[d];break;case "fixed":case "active":case "hidden":case "forceLabel":a[d]=!!b[d];break;case "color":case "label":a[d]=(b[d]||"").toString();break;default:a.attr[d]=b[d]}});return d};this.getEdges=function(a){var b=((a instanceof Array?a:[a])||[]).map(function(a){return l(d.edgesIndex[a])});return a instanceof Array?b:b[0]};this.getNodes=function(a){var f=((a instanceof Array?a:[a])||[]).map(function(a){return b(d.nodesIndex[a])});return a instanceof Array?f:f[0]};
this.empty=f;this.rescale=function(a,b,c,f){var l=0,h=0;c&&d.nodes.forEach(function(a){h=Math.max(a.size,h)});f&&d.edges.forEach(function(a){l=Math.max(a.size,l)});var h=h||1,l=l||1,x,g,k,m;c&&d.nodes.forEach(function(a){g=Math.max(a.x,g||a.x);x=Math.min(a.x,x||a.x);m=Math.max(a.y,m||a.y);k=Math.min(a.y,k||a.y)});var n="outside"==d.p.scalingMode?Math.max(a/Math.max(g-x,1),b/Math.max(m-k,1)):Math.min(a/Math.max(g-x,1),b/Math.max(m-k,1)),q=(d.p.maxNodeSize||h)/n+d.p.sideMargin;g+=q;x-=q;m+=q;k-=q;var n=
"outside"==d.p.scalingMode?Math.max(a/Math.max(g-x,1),b/Math.max(m-k,1)):Math.min(a/Math.max(g-x,1),b/Math.max(m-k,1)),v,y;d.p.maxNodeSize||d.p.minNodeSize?d.p.maxNodeSize==d.p.minNodeSize?(v=0,y=d.p.maxNodeSize):(v=(d.p.maxNodeSize-d.p.minNodeSize)/h,y=d.p.minNodeSize):(v=1,y=0);var B,E;d.p.maxEdgeSize||d.p.minEdgeSize?(B=d.p.maxEdgeSize==d.p.minEdgeSize?0:(d.p.maxEdgeSize-d.p.minEdgeSize)/l,E=d.p.minEdgeSize):(B=1,E=0);c&&d.nodes.forEach(function(c){c.displaySize=c.size*v+y;c.fixed||(c.displayX=
(c.x-(g+x)/2)*n+a/2,c.displayY=(c.y-(m+k)/2)*n+b/2)});f&&d.edges.forEach(function(a){a.displaySize=a.size*B+E});return d};this.translate=function(a,b,c,f,l){var h=Math.pow(c,d.p.nodesPowRatio);f&&d.nodes.forEach(function(d){d.fixed||(d.displayX=d.displayX*c+a,d.displayY=d.displayY*c+b);d.displaySize*=h});l&&d.edges.forEach(function(a){a.displaySize*=Math.pow(c,d.p.edgesPowRatio);a.arrowDisplaySize=a.displaySize*d.p.arrowRatio*h});return d};this.setBorders=function(){d.borders={};d.nodes.forEach(function(a){d.borders.minX=
Math.min(void 0==d.borders.minX?a.displayX-a.displaySize:d.borders.minX,a.displayX-a.displaySize);d.borders.maxX=Math.max(void 0==d.borders.maxX?a.displayX+a.displaySize:d.borders.maxX,a.displayX+a.displaySize);d.borders.minY=Math.min(void 0==d.borders.minY?a.displayY-a.displaySize:d.borders.minY,a.displayY-a.displaySize);d.borders.maxY=Math.max(void 0==d.borders.maxY?a.displayY-a.displaySize:d.borders.maxY,a.displayY-a.displaySize)})};this.checkHover=function(a,b){var c,f,l,h=[],k=[];d.nodes.forEach(function(d){if(d.hidden)d.hover=
!1;else{c=Math.abs(d.displayX-a);f=Math.abs(d.displayY-b);l=d.displaySize;var m=d.hover,n=c<l&&f<l&&Math.sqrt(c*c+f*f)<l;m&&!n?(d.hover=!1,k.push(d.id)):n&&!m&&(d.hover=!0,h.push(d.id))}});h.length&&d.dispatch("overnodes",h);k.length&&d.dispatch("outnodes",k);return d}}function u(b){function l(b){a.p.mouseEnabled&&(f(a.mouseX,a.mouseY,a.ratio*(0<(void 0!=b.wheelDelta&&b.wheelDelta||void 0!=b.detail&&-b.detail)?a.p.zoomMultiply:1/a.p.zoomMultiply)),a.p.blockScroll&&(b.preventDefault?b.preventDefault():
b.returnValue=!1))}function f(b,c,f){a.isMouseDown||(window.clearInterval(a.interpolationID),y=void 0!=f,k=a.stageX,n=b,m=a.stageY,g=c,z=f||a.ratio,z=Math.min(Math.max(z,a.p.minRatio),a.p.maxRatio),v=a.p.directZooming?1-(y?a.p.zoomDelta:a.p.dragDelta):0,a.ratio==z&&a.stageX==n&&a.stageY==g)||(d(),a.interpolationID=window.setInterval(d,50),a.dispatch("startinterpolate"))}function d(){v+=y?a.p.zoomDelta:a.p.dragDelta;v=Math.min(v,1);var b=sigma.easing.quadratic.easeout(v),c=a.ratio;a.ratio=c*(1-b)+
z*b;y?(a.stageX=n+(a.stageX-n)*a.ratio/c,a.stageY=g+(a.stageY-g)*a.ratio/c):(a.stageX=k*(1-b)+n*b,a.stageY=m*(1-b)+g*b);a.dispatch("interpolate");1<=v&&(window.clearInterval(a.interpolationID),b=a.ratio,y?(a.ratio=z,a.stageX=n+(a.stageX-n)*a.ratio/b,a.stageY=g+(a.stageY-g)*a.ratio/b):(a.stageX=n,a.stageY=g),a.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var a=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,
directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var h=0,c=0,k=0,m=0,z=1,n=0,g=0,q=0,t=0,u=0,D=0,v=0,y=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",l,!0);b.addEventListener("mousewheel",l,!0);b.addEventListener("mousemove",function(b){a.mouseX=void 0!=b.offsetX&&b.offsetX||void 0!=b.layerX&&b.layerX||void 0!=b.clientX&&b.clientX;a.mouseY=void 0!=b.offsetY&&b.offsetY||void 0!=b.layerY&&b.layerY||void 0!=b.clientY&&
b.clientY;if(a.isMouseDown){var d=a.mouseX-h+k,f=a.mouseY-c+m;if(d!=a.stageX||f!=a.stageY)t=q,D=u,q=d,u=f,a.stageX=d,a.stageY=f,a.dispatch("drag")}a.dispatch("move");b.preventDefault?b.preventDefault():b.returnValue=!1},!0);b.addEventListener("mousedown",function(b){a.p.mouseEnabled&&(a.isMouseDown=!0,a.dispatch("mousedown"),k=a.stageX,m=a.stageY,h=a.mouseX,c=a.mouseY,t=q=a.stageX,D=u=a.stageY,a.dispatch("startdrag"),b.preventDefault?b.preventDefault():b.returnValue=!1)},!0);document.addEventListener("mouseup",
function(b){a.p.mouseEnabled&&a.isMouseDown&&(a.isMouseDown=!1,a.dispatch("mouseup"),k==a.stageX&&m==a.stageY||f(a.stageX+a.p.inertia*(a.stageX-t),a.stageY+a.p.inertia*(a.stageY-D)),b.preventDefault?b.preventDefault():b.returnValue=!1)},!0);this.checkBorders=function(b,c,d){return a};this.interpolate=f}var t=0,G={plugins:[]};sigma.init=function(b){b=new k(b,(++t).toString());sigma.instances[t]=new m(b);return sigma.instances[t]};sigma.chronos=new function(){function b(a){window.setTimeout(a,0);return n}
function l(){for(n.dispatch("frameinserted");q&&w.length&&f(););q&&w.length?(B=(new Date).getTime(),u++,E=v-F,D=F-E,n.dispatch("insertframe"),b(l)):a()}function f(){C%=w.length;if(!w[C].task()){var a=w[C].taskName;A=A.filter(function(b){b.taskParent==a&&w.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});n.dispatch("killed",w.splice(C--,1)[0])}C++;v=(new Date).getTime()-B;return v<=D}function d(){q=!0;u=C=0;y=B=(new Date).getTime();n.dispatch("start");n.dispatch("insertframe");b(l);
return n}function a(){n.dispatch("stop");q=!1;return n}function h(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');w.push({taskName:b,task:a});q=!!(q||c&&d()||1);return n}function c(a){return a?Object.keys(r).filter(function(a){return!!r[a].on}).length:Object.keys(r).length}function k(){Object.keys(r).length?(n.dispatch("startgenerators"),n.unbind("killed",m),b(function(){for(var a in r)r[a].on=!0,h(r[a].task,a,!1)}),n.bind("killed",m).runTasks()):n.dispatch("stopgenerators");
return n}function m(a){void 0!=r[a.content.taskName]&&(r[a.content.taskName].del||!r[a.content.taskName].condition()?delete r[a.content.taskName]:r[a.content.taskName].on=!1,0==c(!0)&&k())}sigma.classes.EventDispatcher.call(this);var n=this,q=!1,g=80,t=0,u=0,F=1E3/g,D=F,v=0,y=0,B=0,E=0,r={},w=[],A=[],C=0;this.frequency=function(a){return void 0!=a?(g=Math.abs(1*a),F=1E3/g,u=0,n):g};this.runTasks=d;this.stopTasks=a;this.insertFrame=b;this.addTask=h;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+
b+'" is not a function');if(!w.concat(A).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');A.push({taskParent:c,taskName:b,task:a});return n};this.removeTask=function(b,c){if(void 0==b)w=[],1==c?A=[]:2==c&&(w=A,A=[]),a();else{var d="string"==typeof b?b:"";w=w.filter(function(a){return("string"==typeof b?a.taskName==b:a.task==b)?(d=a.taskName,!1):!0});0<c&&(A=A.filter(function(a){1==c&&a.taskParent==d&&w.push(a);return a.taskParent!=d}))}q=!!(!w.length||
a()&&0);return n};this.addGenerator=function(a,b,d){if(void 0!=r[a])return n;r[a]={task:b,condition:d};0==c(!0)&&k();return n};this.removeGenerator=function(a){r[a]&&(r[a].on=!1,r[a].del=!0);return n};this.startGenerators=k;this.getGeneratorsIDs=function(){return Object.keys(r)};this.getFPS=function(){q&&(t=Math.round(1E4*(u/((new Date).getTime()-y)))/10);return t};this.getTasksCount=function(){return w.length};this.getQueuedTasksCount=function(){return A.length};this.getExecutionTime=function(){return B-
y};return this};sigma.addPlugin=function(b,l,f){m.prototype[b]=l;G.plugins.push(f)};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var b in arguments)console.log(arguments[b]);else if(1<sigma.debugMode)for(b in arguments)throw Error(arguments[b]);return sigma};sigma.tools.drawRoundRect=function(b,l,f,d,a,h,c){h=h?h:0;var k=c?c:[],k="string"==typeof k?k.split(" "):k;c=h&&(0<=k.indexOf("topleft")||0<=k.indexOf("top")||0<=k.indexOf("left"));var m=h&&(0<=k.indexOf("topright")||0<=k.indexOf("top")||
0<=k.indexOf("right")),n=h&&(0<=k.indexOf("bottomleft")||0<=k.indexOf("bottom")||0<=k.indexOf("left")),k=h&&(0<=k.indexOf("bottomright")||0<=k.indexOf("bottom")||0<=k.indexOf("right"));b.moveTo(l,f+h);c?b.arcTo(l,f,l+h,f,h):b.lineTo(l,f);m?(b.lineTo(l+d-h,f),b.arcTo(l+d,f,l+d,f+h,h)):b.lineTo(l+d,f);k?(b.lineTo(l+d,f+a-h),b.arcTo(l+d,f+a,l+d-h,f+a,h)):b.lineTo(l+d,f+a);n?(b.lineTo(l+h,f+a),b.arcTo(l,f+a,l,f+a-h,h)):b.lineTo(l,f+a);b.lineTo(l,f+h)};sigma.tools.drawArrowhead=function(b,h,f,d,a){b.beginPath();
b.moveTo(h,f);var k=h+Math.cos(0.017453292519943295*(22+a))*d,c=f+Math.sin(0.017453292519943295*(22+a))*d,m=h+Math.cos(0.017453292519943295*(a-22))*d;d=f+Math.sin(0.017453292519943295*(a-22))*d;b.lineTo(k,c);b.quadraticCurveTo((h+k+m)/3,(f+c+d)/3,m,d);b.lineTo(h,f);b.fill()};sigma.tools.getRGB=function(b,h){b=b.toString();var f={r:0,g:0,b:0};if(3<=b.length&&"#"==b.charAt(0)){var d=b.length-1;6==d?f={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+
b.charAt(5),16)}:3==d&&(f={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+b.charAt(3),16)})}h&&(f=[f.r,f.g,f.b]);return f};sigma.tools.rgbToHex=function(b,h,f){return sigma.tools.toHex(b)+sigma.tools.toHex(h)+sigma.tools.toHex(f)};sigma.tools.toHex=function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.tools.getIncidenceAngle=function(b,
h,f,d){return(b<=f?180:0)+180*Math.atan((d-h)/(f-b))/Math.PI};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.publicPrototype=m.prototype})();
